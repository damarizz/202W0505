---
import fs from 'node:fs/promises';

type Props = {
  file: string;
  line_start?: number;
  line_end?: number;
}

const { file, line_start, line_end } = Astro.props;

let assets_dir = './../assets/code';
if (import.meta.env.PROD) {
  assets_dir = '../code';
}

const url = new URL(`${assets_dir}/${file}`, import.meta.url);

let content = await fs.readFile(url, 'utf-8');
content = content.split('\n').slice((line_start ?? 1) - 1, line_end).join('\n');
---

<div>
  <span>{file}</span>
  <code>
    {content}
  </code>
</div>

<style lang="scss">
  code {
    display: block;
    padding: 1rem;
    background-color: #f5f5f5;
    border-radius: 0.5rem;
    overflow: auto;
    white-space: pre;
    margin-bottom: 10px;
  }

  div {
    position: relative;
  }
  span {
    position: absolute;
    top: 6px;
    right: 10px;
    z-index: 10000;
    font-size: 14px;
  }
</style>
